<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="theme-color" content="#a4cfdf">
  
  <title>宠物店服务号预约系统项目全流程记录 | Constantin</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="需求分析如图">
<meta name="keywords" content="项目总结">
<meta property="og:type" content="article">
<meta property="og:title" content="宠物店服务号预约系统项目全流程记录">
<meta property="og:url" content="http://yoursite.com/2018/05/09/pet/index.html">
<meta property="og:site_name" content="Constantin">
<meta property="og:description" content="需求分析如图">
<meta property="og:locale" content="default">
<meta property="og:image" content="http://yoursite.com/img/qxqy-need.png">
<meta property="og:image" content="http://yoursite.com/img/qxqy-file.png">
<meta property="og:image" content="http://yoursite.com/img/qxqy-file-server.png">
<meta property="og:image" content="http://yoursite.com/img/%20qxqy-accessToken.png">
<meta property="og:image" content="http://yoursite.com/img/pet.jpg">
<meta property="og:updated_time" content="2018-05-09T08:58:37.138Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="宠物店服务号预约系统项目全流程记录">
<meta name="twitter:description" content="需求分析如图">
<meta name="twitter:image" content="http://yoursite.com/img/qxqy-need.png">
  
    <link rel="alternative" href="/atom.xml" title="Constantin" type="application/atom+xml">
  
  
    <link rel="icon" href="/img/favicon.png">
  
  <link rel="stylesheet" href="/css/style.css">
  <script src="https://libs.baidu.com/jquery/1.9.0/jquery.js"></script>
</head>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			<img lazy-src="/img/head(2).png" class="js-avatar">
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">Constantin</a></h1>
		</hgroup>

		

		
			<div class="switch-btn">
				<div class="icon">
					<div class="icon-ctn">
						<div class="icon-wrap icon-house" data-idx="0">
							<div class="birdhouse"></div>
							<div class="birdhouse_holes"></div>
						</div>
						<div class="icon-wrap icon-ribbon hide" data-idx="1">
							<div class="ribbon"></div>
						</div>
						
						<div class="icon-wrap icon-link hide" data-idx="2">
							<div class="loopback_l"></div>
							<div class="loopback_r"></div>
						</div>
						
						
						<div class="icon-wrap icon-me hide" data-idx="3">
							<div class="user"></div>
							<div class="shoulder"></div>
						</div>
						
					</div>
					
				</div>
				<div class="tips-box hide">
					<div class="tips-arrow"></div>
					<ul class="tips-inner">
						<li>菜单</li>
						<li>标签</li>
						
						<li>友情链接</li>
						
						
						<li>关于我</li>
						
					</ul>
				</div>
			</div>
		

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">主页</a></li>
				        
							<li><a href="/archives">归档</a></li>
				        
							<li><a href="https://www.instagram.com/prconstantin/">ins</a></li>
				        
							<li><a href="https://twitter.com/PrConstantine?lang=zh-cn">twitter</a></li>
				        
							<li><a href="http://ingress.constantin.cc">ingress</a></li>
				        
						</ul>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
								<a class="github" target="_blank" href="https://github.com/uselessaddress" title="github">github</a>
					        
								<a class="rss" target="_blank" href="/atom.xml" title="rss">rss</a>
					        
								<a class="mail" target="_blank" href="/" title="mail">mail</a>
					        
						</div>
					</nav>
				</section>
				
				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						<a href="/tags/GameAI/" style="font-size: 10px;">GameAI</a> <a href="/tags/Javascript/" style="font-size: 20px;">Javascript</a> <a href="/tags/React/" style="font-size: 10px;">React</a> <a href="/tags/css/" style="font-size: 10px;">css</a> <a href="/tags/react-native/" style="font-size: 10px;">react-native</a> <a href="/tags/server/" style="font-size: 10px;">server</a> <a href="/tags/ssh/" style="font-size: 10px;">ssh</a> <a href="/tags/全景/" style="font-size: 10px;">全景</a> <a href="/tags/内网穿透/" style="font-size: 10px;">内网穿透</a> <a href="/tags/实习项目总结/" style="font-size: 20px;">实习项目总结</a> <a href="/tags/随笔/" style="font-size: 10px;">随笔</a> <a href="/tags/面试题/" style="font-size: 10px;">面试题</a> <a href="/tags/项目总结/" style="font-size: 20px;">项目总结</a>
					</div>
				</section>
				
				
				
				<section class="switch-part switch-part3">
					<div id="js-friends">
					
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://mzi.red">MZI</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="https://sanmumuzi.github.io">sanmumuzi</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="https://frankrx41.github.io/">FrankRx41</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="https://soiomon.github.io/">Solomon</a>
			        
			        </div>
				</section>
				

				
				
				<section class="switch-part switch-part4">
				
					<div id="js-aboutme">NJUPT、前端、Ingress-Enlightened</div>
				</section>
				
			</div>
		</div>
	</header>	
	<div class="hide-left">
	</div>			
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide">Constantin</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				<img lazy-src="/img/head(2).png" class="js-avatar">
			</div>
			<hgroup>
			  <h1 class="header-author">Constantin</h1>
			</hgroup>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
					<li><a href="/archives">归档</a></li>
		        
					<li><a href="https://www.instagram.com/prconstantin/">ins</a></li>
		        
					<li><a href="https://twitter.com/PrConstantine?lang=zh-cn">twitter</a></li>
		        
					<li><a href="http://ingress.constantin.cc">ingress</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="https://github.com/uselessaddress" title="github">github</a>
			        
						<a class="rss" target="_blank" href="/atom.xml" title="rss">rss</a>
			        
						<a class="mail" target="_blank" href="/" title="mail">mail</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>
      <div class="body-wrap"><article id="post-pet" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      

<a href="/2018/05/09/pet/" class="article-date">
  	<time datetime="2018-05-09T08:58:37.137Z" itemprop="datePublished">2018-05-09</time>
  	<br/>
    
        <span id="busuanzi_container_page_pv" style="color:DarkGray">
        view <span id="busuanzi_value_page_pv"></span> times 
        </span>
    
</a>
<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>

    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      宠物店服务号预约系统项目全流程记录
    </h1>
  

      </header>
      
      <div class="article-info article-info-post">
        
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/项目总结/">项目总结</a></li></ul>
	</div>

        

        <div class="clearfix"></div>
      </div>
      
    
    <div class="article-entry" itemprop="articleBody">	
      


      <div class="back-top"></div>
	  
		
			<div id="toc" class="toc-article">
			  <strong class="toc-title">文章目录</strong>
			  <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#需求分析如图"><span class="toc-number">1.</span> <span class="toc-text">需求分析如图</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#用户"><span class="toc-number">1.1.</span> <span class="toc-text">用户</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#管理员"><span class="toc-number">1.2.</span> <span class="toc-text">管理员</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#技术栈"><span class="toc-number">2.</span> <span class="toc-text">技术栈</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#一些开发细节"><span class="toc-number">3.</span> <span class="toc-text">一些开发细节</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#使用到的微信接口记录"><span class="toc-number">3.1.</span> <span class="toc-text">使用到的微信接口记录</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#使用element-ui"><span class="toc-number">3.2.</span> <span class="toc-text">使用element-ui</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Nuxt的asyncData-方法"><span class="toc-number">3.3.</span> <span class="toc-text">Nuxt的asyncData 方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#微信开发工具"><span class="toc-number">3.4.</span> <span class="toc-text">微信开发工具</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#基于Mongoose和bcrypt的密码验证"><span class="toc-number">3.5.</span> <span class="toc-text">基于Mongoose和bcrypt的密码验证</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#总结"><span class="toc-number">4.</span> <span class="toc-text">总结</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#声明"><span class="toc-number">5.</span> <span class="toc-text">声明</span></a></li></ol>
			</div>
		
		
        <h2 id="需求分析如图"><a href="#需求分析如图" class="headerlink" title="需求分析如图"></a>需求分析如图</h2><p><img src="/img/qxqy-need.png" alt="需求"><br><a id="more"></a></p>
<h3 id="用户"><a href="#用户" class="headerlink" title="用户"></a>用户</h3><p>用户通过服务号菜单点击进入，获取到用户的openId，通过openId获取该用户的历史订单记录，订单状态有三个，第一个是订单提交然后等待管理员确认，第二个是管理员已经确认，等待到店服务，第三个是已经服务过的记录，被拒绝的订单只发通知不做记录。还有就是通过填写宠物洗澡和美容的预约表单进行提交，提交的表单状态为待确认表单。</p>
<h3 id="管理员"><a href="#管理员" class="headerlink" title="管理员"></a>管理员</h3><p>管理员分级，只有BOSS账号才能改变订单的状态，即接受订单或是拒绝订单，将待服务订单变为已服务，剩下的服务人员使用账号则只能查看到哪些待服务的订单</p>
<h2 id="技术栈"><a href="#技术栈" class="headerlink" title="技术栈"></a>技术栈</h2><ul>
<li>nuxt.js（element-ui） + express + mongodb</li>
<li>nuxt.js是基于Vue的SSR(服务端渲染)应用框架,集成了Vue、Vue-Router、Vuex,集成到express中当作中间件来使用，负责UI渲染部分的功能。这里我之所以选择使用nuxt，还真不是为了解决SEO和首屏加载问题，而是考虑到其爽快的开发流程，首先介绍项目的文件结构：如下图<img src="/img/qxqy-file.png" alt="文件结构">可以看到除了nuxt本身的文件结构，只需要新建一个server文件夹,然后配置nodemon，开启express的热更新，然后把nuxt当作中间引入并开启：<figure class="highlight zephir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; Nuxt, Builder &#125; = <span class="keyword">require</span>(<span class="string">'nuxt'</span>)</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="comment">// Import and Set Nuxt.js options</span></span><br><span class="line"><span class="keyword">let</span> nuxtConfig = <span class="keyword">require</span>(<span class="string">'../nuxt.config.js'</span>)</span><br><span class="line">nuxtConfig.dev = !(process.env.NODE_ENV === <span class="string">'production'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Init Nuxt.js</span></span><br><span class="line"><span class="keyword">const</span> nuxt = <span class="keyword">new</span> Nuxt(nuxtConfig)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Build only in dev mode</span></span><br><span class="line"><span class="keyword">if</span> (nuxtConfig.dev) &#123;</span><br><span class="line">  <span class="keyword">const</span> builder = <span class="keyword">new</span> Builder(nuxt)</span><br><span class="line">  builder.build()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Give nuxt middleware to express</span></span><br><span class="line">app.<span class="keyword">use</span>(nuxt.render)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>这样一来借助nuxt的热更新服务，也做到前端代码的热更新，server文件夹的结构如下：<img src="/img/qxqy-file-server.png" alt="文件结构">可以看到在api里编写前后端约定交互的接口，在model里建立mongoose的Schema，在wx里封装微信的接口调用，整体开发思路很清晰，也很便捷，进行整站开发更加迅速。</p>
<h2 id="一些开发细节"><a href="#一些开发细节" class="headerlink" title="一些开发细节"></a>一些开发细节</h2><h3 id="使用到的微信接口记录"><a href="#使用到的微信接口记录" class="headerlink" title="使用到的微信接口记录"></a>使用到的微信接口记录</h3><ul>
<li>首先是验证消息是否来自微信服务器：从请求中获取到signature字段，timestamp字段，nonce，echostr字段，提取成功后将token\timestamp\nonce字符串排序得到list，使用hash加密得到hashcode，最后判断hashcode是否等于signature，是的话则说明数据源是微信后台，最后把echostr返回给微信后台去验证token，在这里我把自定义菜单设置放到了确认是微信服务器后。</li>
<li>自定义菜单：设置之前需要获取到全局accessToken，这个值需要自己请求并且保存，然后设置超时，超时后重新请求，在mongoose里设置超时使用如下方法：<img src="/img/ qxqy-accessToken.png" alt="需求"><a href="http://mongoosejs.com/docs/3.8.x/docs/api.html#schema-date-js" target="_blank" rel="noopener">官方文档</a><br>然后拿accessToken去更新自定义菜单。请求链接和返回值就都在微信文档里有，不再细表。<ul>
<li>通过网页授权获取用户的信息：这里需要通过链接进入授权页，在链接里写上服务号的appID和重定向的链接，这样在用户授权后就会跳转到你设置的链接，链接后面还会带上一个code（code说明 ： code作为换取access_token的票据，每次用户授权带上的code将不一样，code只能使用一次，5分钟未被使用自动过期。）然后通过这个code去获取网页授权access_token,与基础支持中的access_token（该access_token用于调用其他接口）不同。最后通过这个access_token获取到用户的openId，用户名等信息。</li>
<li>模板消息：因为需要给用户和管理员提示信息，比如告知预定成功、失败等，所以需要先配置需要使用的模板消息，然后根据模板消息ID和目标用户的openID给其发送模板消息。</li>
</ul>
</li>
</ul>
<h3 id="使用element-ui"><a href="#使用element-ui" class="headerlink" title="使用element-ui"></a>使用element-ui</h3><ul>
<li>UI框架使用到了<a href="http://element.eleme.io/#/zh-CN" target="_blank" rel="noopener">element-ui</a>，整个开发流程下来使用体验很棒，没有遇到什么需要记录的问题。</li>
</ul>
<h3 id="Nuxt的asyncData-方法"><a href="#Nuxt的asyncData-方法" class="headerlink" title="Nuxt的asyncData 方法"></a>Nuxt的asyncData 方法</h3><ul>
<li>asyncData方法会在组件（限于页面组件）每次加载之前被调用。它可以在服务端或路由更新之前被调用。 在这个方法被调用的时候，第一个参数被设定为当前页面的上下文对象，你可以利用 asyncData方法来获取数据，Nuxt.js 会将 asyncData 返回的数据融合组件 data 方法返回的数据一并返回给当前组件。</li>
<li>在管理员获取当前所有数据时我使用到了asyncData方法，相比在SPA在Vue或者React的mounted周期请求数据再渲染，在数据量大了之后速度提升非常明显，毕竟这也算是SSR解决首屏渲染问题的方法了。</li>
</ul>
<h3 id="微信开发工具"><a href="#微信开发工具" class="headerlink" title="微信开发工具"></a>微信开发工具</h3><ul>
<li>frp 搭建内网穿透，直接真机调试，详见之前的博客 <a href="http://constantin.cc/2018/01/20/frps/" target="_blank" rel="noopener">使用frp配置内网穿透</a></li>
<li>微信网页开发工具，因为一些跳转需要到微信中调试，但是真机没有控制台，所以直接用微信的网页开发工具。</li>
</ul>
<h3 id="基于Mongoose和bcrypt的密码验证"><a href="#基于Mongoose和bcrypt的密码验证" class="headerlink" title="基于Mongoose和bcrypt的密码验证"></a>基于Mongoose和bcrypt的密码验证</h3><ul>
<li><a href="http://www.html-js.com/article/1522" target="_blank" rel="noopener">详见这篇文章</a></li>
</ul>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>总结下个人项目流程，最开始需要和甲方进行沟通，确定需求，画出需求分析图，然后再沟通看是否达到要求最终确定需求；接下来是选定技术栈，技术栈的选择就看个人经验了，毕竟做快速应用开发，效率和经验很重要，熟练来什么，这时候可以交互画一下流程图，然后把前后端接口文档写好；接下来就是项目开发，项目开发我习惯从前端页面开始，没有设计图就直接上UI框架，前端页面写好后就开始按照接口文档编写交互部分代码，按照顺序一个个接口的写过去，写完一个就调试一个，最后所有接口写完后再根据流程图做测试,最后部署上线,使用没问题后就可以交付了。</p>
<p><img src="/img/pet.jpg" alt="darling"></p>
<h2 id="声明"><a href="#声明" class="headerlink" title="声明"></a>声明</h2><p>作者 ： PrConstantin<br>来源 ： <a href="http://constantin.cc" target="_blank" rel="noopener">http://constantin.cc</a>  </p>

      
    </div>
    
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2018/05/09/interview/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption"><</strong>
      <div class="article-nav-title">
        
          一道关于JavaScript解析器错误的面试题
        
      </div>
    </a>
  
  
    <a href="/2018/05/09/es6-tag/" id="article-nav-older" class="article-nav-link-wrap">
      <div class="article-nav-title">从 ES6 的标签( tag )函数聊起</div>
      <strong class="article-nav-caption">></strong>
    </a>
  
</nav>

  
</article>





</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2018 Constantin
    	</div>
      	<div class="footer-right">
      		<a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a> by Litten
      	</div>
    </div>
  </div>
</footer>
    </div>
    
  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/mobile.js"></script>
<script src="/js/main.js"></script>





<! -- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>



  </div>
<script src="/live2dw/lib/L2Dwidget.min.js?0c58a1486de42ac6cc1c59c7d98ae887"></script><script>L2Dwidget.init({"model":{"scale":0.6,"hHeadPos":1,"vHeadPos":1,"jsonPath":"https://cdn.jsdelivr.net/npm/live2d-widget-model-miku@1.0.5/assets/miku.model.json"},"display":{"superSample":2,"width":80,"height":170,"position":"left","hOffset":15,"vOffset":-65},"mobile":{"show":false},"react":{"opacityDefault":0.9,"opacityOnHover":0.2},"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/"});</script></body>
</html>